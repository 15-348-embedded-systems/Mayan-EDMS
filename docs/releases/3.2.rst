Version 3.2
===========

Released: XX XX, 2019


Changes
-------

Switch to full app paths
^^^^^^^^^^^^^^^^^^^^^^^^
Instead of inserting the path of the apps into the Python app,
the apps are now referenced by their full import path.

This solves name clashes with external or native Python libraries.
Example: Mayan statistics app vs. Python new statistics library.

Every app reference is now prepended with 'mayan.apps'.

Existing config.yml files need to be updated manually.


Permissions
^^^^^^^^^^^
The role permission grant and revoke permissions were removed. Instead only the
role edit permission is required to grant or revoke permissions to a role.


Development
^^^^^^^^^^^
URLs: Remove development URLs from main URL file

Move the development URL definitions for Rosetta and Debug toolbar
to a separate URL file. Convert the single urls.py to a module to
allow multiple URL files to be used.


Settings
^^^^^^^^

New default value for setting DOCUMENTS_HASH_BLOCK_SIZE is 65535.
New default value for setting MIMETYPE_FILE_READ_SIZE is 1024.

User interface
^^^^^^^^^^^^^^

Usage of select2 in more places (FilteredSelectionForm).
Cabinets, Tags, Rebuild index.


Other changes
^^^^^^^^^^^^^

* Split source models into different modules.
* Fix multiple tag selection wizard step.
* Split document app models into separate modules.
* Split workflow views into separate modules.
* Change how the HOME_VIEW setting is defined. HOME_VIEW is now COMMON_HOME_VIEW.
* Split trashed document views into their own module.
* Remove Django suit from requirements.
* Move API documentation generation from the root URLs module
  to the API app's URLs module.
* Update PyYAML to version 5.1. Update use of safe_load and
  safe_dump to load and dump using the CSafeLoader and SafeLoader as fallback.
* Add SilenceLoggerTestCaseMixin to lower level of loggers
  during tests.
* Add workaround for Tesseract bug 1670
  https://github.com/tesseract-ocr/tesseract/issues/1670
  https://github.com/tesseract-ocr/tesseract/commit/3292484f67af8bdda23aa5e510918d0115785291
  https://gitlab.gnome.org/World/OpenPaperwork/pyocr/issues/104
* Move setting COMMON_TEMPORARY_DIRECTORY to the storage app.
  The setting is now STORAGE_TEMPORARY_DIRECTORY.
* Move file related utilities to the storage app.
* Backport and remove unused code from the permission app.
* Move the navigation and authentication templates to their
  respective apps.
* Add dashboard app.
* Remove queryset slicing hack from the Document list view.
  And slice the Recently Added Document queryset itself.
* Move stub filtering to the Document model manager.
* Increase the default number of recently added documents and
  recently accessed documents from 40 to 400.
* Integrate django-autoadmin into the core apps.
* Update middleware to new style classes.
* Add server side invalid document template.
* Move tag specific JavaScript to the tags app.
* Reduce form boilerplate code with new FormOptions class.
* Use FormOptions for the DetailForm class.
* DetailForm now support help text on extra fields.
* Add FilteredSelectionForm class.
* Use FilteredSelectionForm for TagMultipleSelectionForm.
* Use FilteredSelectionForm for the class CabinetListForm.
* Add keyword arguments to URL definitions.
* Use FilteredSelectionForm to add a new ACLCreateForm.
* Rename IndexListForm to IndexTemplateFilteredForm.
* Use FilteredSelectionForm for IndexTemplateFilteredForm.
* Use FilteredSelectionForm for DocumentVersionSignatureCreateForm.
* Improve document signatures tests.
* Add docstrings to most models.
* Add support to the mailing profiles for specifying a from
  address. Closes GitLab issue #522.
* Expose new Django settings: AUTH_PASSWORD_VALIDATORS, DEFAULT_FROM_EMAIL,
  EMAIL_TIMEOUT, INTERNAL_IPS, LANGUAGES, LANGUAGE_CODE, STATIC_URL,
  STATICFILES_STORAGE, TIME_ZONE, WSGI_APPLICATION.
* Convert language choices into a function.
* Move language choices generation to documents.utils.
* Remove support for generating documents images in base 64
  format.
* Move Pillow initialization from the module to the backend
  class initialization.
* Remove star import from the ACL and Common apps.
* Add dependencies app
* Convert the document tags widget to use HTML templates.
* Move Tag app HTML widgets to their own module.
* Move the document index app widgets to the html_widget.py
  module.
* Update group members view permission. The group edit and
  user edit permission are now required.
* Add keyword arguments to messages uses.
* Add keyword arguments to the reverse use in views.
* Add MERCs 5 and 6. 
* Update authentication function views to use Django's new class
  based authentication views.
* Expose Django's LOGOUT_REDIRECT_URL setting.
* Move current user views from the common app to the user
  management app.
* Move the purge permission logic to the StorePermission
  manager.
* Remove the MIMETYPE_FILE_READ_SIZE setting.
* Use copyfileobj in the document parsers.
* Backport list facet menu code.
* Backport sidebar code.
* CSS updates to maximize usable width.
* Improve partial navigation error messages and display.
* Add user created and user edited events.
* Add group created and group edited events.
* Add support for SourceColumn widgets.
* Improve styling of the template debug view.
* Add support for showing the current user's events.
* Add support kwargs to the SourceColumn class.
* Improve the event widgets, views and tests.
* Add mailer use event.
* Remove the include fontawesome and download it from
  the NPMregistry.
* Fix issue installing scoped NPM packages.
* Add new icons classes and templates.
* Add support for link icon path imports.
* Remove support for link icon strings.
* Split document app form into separate modules.
* Move the favorite document views to their own module.
* Replace DocumentTypeSelectioForm with an improved
  version that does filtering.
* Update OCR links activation.
* Update document parsing link activation.
* Add favorite document views tests.

Removals
--------

* Django suit third party app.


Upgrading from a previous version
---------------------------------

If installed via Python's PIP
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Remove deprecated requirements::

    $ curl https://gitlab.com/mayan-edms/mayan-edms/raw/master/removals.txt | pip uninstall -r /dev/stdin

Type in the console::

    $ pip install mayan-edms==3.2

the requirements will also be updated automatically.


Using Git
^^^^^^^^^

If you installed Mayan EDMS by cloning the Git repository issue the commands::

    $ git reset --hard HEAD
    $ git pull

otherwise download the compressed archived and uncompress it overriding the
existing installation.

Remove deprecated requirements::

    $ pip uninstall -y -r removals.txt

Next upgrade/add the new requirements::

    $ pip install --upgrade -r requirements.txt


Common steps
^^^^^^^^^^^^

Perform these steps after updating the code from either step above.

Migrate existing database schema with::

    $ mayan-edms.py performupgrade

Add new static media::

    $ mayan-edms.py collectstatic --noinput

The upgrade procedure is now complete.


Backward incompatible changes
-----------------------------

* None


Bugs fixed or issues closed
---------------------------

* :gitlab-issue:`498` Can't scan subdirectories
* :gitlab-issue:`522` Office 365 SMTP
* :gitlab-issue:`539` Setting for default email sender is missing
* :gitlab-issue:`563` Recursive Watch Folder

.. _PyPI: https://pypi.python.org/pypi/mayan-edms/
