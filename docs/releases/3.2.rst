Version 3.2
===========

Released: XX XX, 2019


Changes
-------

Switch to full app paths
^^^^^^^^^^^^^^^^^^^^^^^^
Instead of inserting the path of the apps into the Python app,
the apps are now referenced by their full import path.

This solves name clashes with external or native Python libraries.
Example: Mayan statistics app vs. Python new statistics library.

Every app reference is now prepended with 'mayan.apps'.

Existing config.yml files need to be updated manually.


Permissions
^^^^^^^^^^^
The role permission grant and revoke permissions were removed. Instead only the
role edit permission is required to grant or revoke permissions to a role.


Development
^^^^^^^^^^^
URLs: Remove development URLs from main URL file

Move the development URL definitions for Rosetta and Debug toolbar
to a separate URL file. Convert the single urls.py to a module to
allow multiple URL files to be used.

Settings
^^^^^^^^

New default value for setting DOCUMENTS_HASH_BLOCK_SIZE is 65535.
New default value for setting MIMETYPE_FILE_READ_SIZE is 1024.

Other changes
^^^^^^^^^^^^^

* Split source models into different modules.
* Fix multiple tag selection wizard step.
* Split document app models into separate modules.
* Split workflow views into separate modules.
* Change how the HOME_VIEW setting is defined. HOME_VIEW is now COMMON_HOME_VIEW.
* Split trashed document views into their own module.
* Remove Django suit from requirements.
* Move API documentation generation from the root URLs module
  to the API app's URLs module.
* Update PyYAML to version 5.1. Update use of safe_load and
  safe_dump to load and dump using the CSafeLoader and SafeLoader as fallback.
* Add SilenceLoggerTestCaseMixin to lower level of loggers
  during tests.
* Add workaround for Tesseract bug 1670
  https://github.com/tesseract-ocr/tesseract/issues/1670
  https://github.com/tesseract-ocr/tesseract/commit/3292484f67af8bdda23aa5e510918d0115785291
  https://gitlab.gnome.org/World/OpenPaperwork/pyocr/issues/104
* Move setting COMMON_TEMPORARY_DIRECTORY to the storage app.
  The setting is now STORAGE_TEMPORARY_DIRECTORY.
* Move file related utilities to the storage app.
* Backport and remove unused code from the permission app.
* Move the navigation and authentication templates to their
  respective apps.
* Add dashboard app.
* Remove queryset slicing hack from the Document list view.
  And slice the Recently Added Document queryset itself.
* Move stub filtering to the Document model manager.
* Increase the default number of recently added documents and
  recently accessed documents from 40 to 400.
* Integrate django-autoadmin into the core apps.
* Update middleware to new style classes.
* Add server side invalid document template.
* Move tag specific JavaScript to the tags app.
* Reduce form boilerplate code with new FormOptions class.
* Use FormOptions for the DetailForm class.
* DetailForm now support help text on extra fields.
* Add FilteredSelectionForm class.
* Use FilteredSelectionForm for TagMultipleSelectionForm.
* Use FilteredSelectionForm for the class CabinetListForm.

Removals
--------

* Django suit third party app.


Upgrading from a previous version
---------------------------------

If installed via Python's PIP
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Remove deprecated requirements::

    $ curl https://gitlab.com/mayan-edms/mayan-edms/raw/master/removals.txt | pip uninstall -r /dev/stdin

Type in the console::

    $ pip install mayan-edms==3.2

the requirements will also be updated automatically.


Using Git
^^^^^^^^^

If you installed Mayan EDMS by cloning the Git repository issue the commands::

    $ git reset --hard HEAD
    $ git pull

otherwise download the compressed archived and uncompress it overriding the
existing installation.

Remove deprecated requirements::

    $ pip uninstall -y -r removals.txt

Next upgrade/add the new requirements::

    $ pip install --upgrade -r requirements.txt


Common steps
^^^^^^^^^^^^

Perform these steps after updating the code from either step above.

Migrate existing database schema with::

    $ mayan-edms.py performupgrade

Add new static media::

    $ mayan-edms.py collectstatic --noinput

The upgrade procedure is now complete.


Backward incompatible changes
-----------------------------

* None


Bugs fixed or issues closed
---------------------------

* :gitlab-issue:`498` Can't scan subdirectories
* :gitlab-issue:`563` Recursive Watch Folder

.. _PyPI: https://pypi.python.org/pypi/mayan-edms/
