=============================
Mayan EDMS v2.2 release notes
=============================

Released: April XX, 2017

What's new
==========

API changes
-----------
Refactor of the metadata API URLs to use the resource/sub resource paradigm.

Before:

/api/metadata/metadata_types/
/api/metadata/metadata_types/{pk}/
/api/metadata/document/metadata/{pk}/
/api/metadata/document/{pk}/metadata/
/api/metadata/document_type/{document_type_pk}/metadata_types/optional/
/api/metadata/document_type/{document_type_pk}/metadata_types/required/

After:

/api/metadata/metadata_types/
/api/metadata/metadata_types/{metadata_type_pk}/
/api/metadata/document_types/{document_type_pk}/metadata_types/
/api/metadata/document_types/{document_type_pk}/metadata_types/{metadata_type_pk}/
/api/metadata/documents/{document_pk}/metadata/
/api/metadata/documents/{document_pk}/metadata/{metadata_pk}/


Document API URLs updated to use the resource/sub resource paradigm.
Before:

/api/documents/document_version<pk>
/api/documents/document_pages<pk>

After:
/api/documents/<pk>/version/<version_pk>
/api/documents/<pk>/version/<version_pk>/pages/<page_pk>

Fields that reference a resource by URL now have the suffix '_url' to differentiate
then from fields include the resource.

Before:

'document': '/api/documents/10'

After:

'document_url': '/api/documents/10'

Removal of the document version revert API endpoint. To revert a document to a
previous version using the API, use the DELETE verb to delete the most recent
document version to be discarded.

Pages data is no longer included as part of the version data. Instead a link to
the document version's pages has been added by the name 'pages_url'. This
resolved to '/api/documents/<pk>/pages/<page_pk>/pages'.

Other changes
-------------
- The user's full name or username is no longer displayed in the main menu.
  Instead the work "Profile" is displayed. The users's full name or username
  will be displayed when the "Profile" icon is clicked. This avoid menu
  style breakable on long full names or usernames.
- Simplify test runner by adding a new option '--mayan-apps' that automatically
  tests all Mayan apps that report to have tests.
- Change the app flag that indicates when an app has test from 'test' to the
  more explicit 'has_test'.
- The packaging manifest now includes test files. Test can now be executed
  in production.
- The Cabinets app integration as core app.
- Add "Check now" button to interval sources.
- Remove the installation app.
- Add support for page search.
- Remove recent searches feature.
- Remove dependency on the django-filetransfer library.
- Fix height calculation in resize transformation.
- Improve upgrade instructions.
- New image caching pipeline.
- New drop down menus for the documents, folders and tags app as well as for
  the user links.
- Add support for a dashboard with default widgets.
- Moved licenses to their own module in every app.
- Update project to work with Django 1.10.
- Tags are alphabetically ordered by label.
- Stop loading theme fonts from the web.
- Add support for attaching multiple tags to single or multiple documents.
- Refactor the workflow for removing tags from single and multiple documents.
- Move new version creation blocking from the documents app to the checkouts app.
- Sample documents moved to distribution to allow running all tests in production.
- DEBUG now defaults to False.
- Production settings don't override the DEBUG variable. DEBUG can be set to True
  on production install to debug errors live.
- Refactor add document to folder view to allow adding a documents to multiple folders at the same time.
- Refactor the remove document from folder view to allow removing documents from multiple folders at the same time.
- Refactor the document mailing views and add support for sending multiple documents via email at the same time.
- Refactor the document metadata views and add support for adding multiple metadata types to a document at the same time.
- Addition of a new OCR backend using PyOCR. This backend tries first to do OCR
  using libtesseract. If libtesseract is not available the backend defaults to
  calling the Tesseract executable.
- Language list moved from document model to document form.
- Enable password validation for the user password change view, user password change API endpoint, current user view and current user API endpoint.
- New API endpoints (initial work by @lokeshmanmode):

  - API endpoint to change an user's groups subscription.
  - API endpoint that list all available permissions types.
  - API endpoint to view or change a role's groups.
  - API endpoint to view or change a role's permissions.

- Make the lock_manager.backends.file_lock.FileLock the new default locking backend.
- Add view to clone a document page transformation to other pages.
- Document page transformation navigation bug fixed.
- Move test total to 359.
- Increase test coverage to 81%.
- New transformations added:

  - Rotate 90 degrees
  - Rotate 180 degrees
  - Rotate 270 degrees
  - Mirror (horizontal)
  - Flip (vertical)
  - Gaussian blur
  - Unsharp masking

- Add custom test runner replacing the custom management command runtests.
  The 'test-all' Makefile target that called the `runtests` command has been removed too.

- Testing for orphaned temporary files and orphaned file handles is now optional and
  controlled by the COMMON_TEST_FILE_HANDLES and COMMON_TEST_FILE_HANDLES settings.

- Add tool to launch all workflows. GitLab issue #355
- New workflow view that lists documents currently executing a workflow and
  documents by their specific current workflow state.

Removals
--------
- Removal of the OCR_TESSERACT_PATH configuration setting.
- Removal of the Tesseract OCR backend. Replaced with a PyOCR backend.
- Remove usage of pytesseract Python library.

Upgrading from a previous version
---------------------------------

If installed via PIP
~~~~~~~~~~~~~~~~~~~~

Type in the console::

    $ pip install -U mayan-edms

the requirements will also be updated automatically.

If installed using Git
~~~~~~~~~~~~~~~~~~~~~~

If you installed Mayan EDMS by cloning the Git repository issue the commands::

    $ git reset --hard HEAD
    $ git pull

otherwise download the compressed archived and uncompress it overriding the
existing installation.

Manually upgrade/add the new requirements::

    $ pip install --upgrade -r requirements.txt

Remove deprecated requirements::

    $ pip uninstall -y -r removals.txt

Common steps
~~~~~~~~~~~~

Migrate existing database schema with::

    $ mayan-edms.py performupgrade

Add new static media::

    $ mayan-edms.py collectstatic --noinput

The upgrade procedure is now complete.


Backward incompatible changes
=============================

* None

Bugs fixed or issues closed
===========================

* `GitLab issue #185 <https://gitlab.com/mayan-edms/mayan-edms/issues/185>`_ Add support for nested menus
* `GitLab issue #285 <https://gitlab.com/mayan-edms/mayan-edms/issues/285>`_ Dashboard widgets
* `GitLab issue #294 <https://gitlab.com/mayan-edms/mayan-edms/issues/294>`_ Move new version creation blocking from the documents app to the checkouts app
* `GitLab issue #301 <https://gitlab.com/mayan-edms/mayan-edms/issues/301>`_ Remove the installation app
* `GitLab issue #303 <https://gitlab.com/mayan-edms/mayan-edms/issues/303>`_ Update urlpatterns in urls.py files to be a list of django.conf.urls.url() instances instead.
* `GitLab issue #304 <https://gitlab.com/mayan-edms/mayan-edms/issues/304>`_ Remove string view arguments of url() in urls.py files.
* `GitLab issue #307 <https://gitlab.com/mayan-edms/mayan-edms/issues/307>`_ Enter multiple Tags at once
* `GitLab issue #310 <https://gitlab.com/mayan-edms/mayan-edms/issues/310>`_ Metadata's lookup with chinese messages when new document
* `GitLab issue #311 <https://gitlab.com/mayan-edms/mayan-edms/issues/311>`_ acl page return ContentType:Document
* `GitLab issue #319 <https://gitlab.com/mayan-edms/mayan-edms/issues/319>`_ TransformationResize issue with very "long" image
* `GitLab issue #328 <https://gitlab.com/mayan-edms/mayan-edms/issues/328>`_ Upgrade Warning/Error during performupgrade (v2.1.3 to v2.1.4)
* `GitLab issue #342 <https://gitlab.com/mayan-edms/mayan-edms/issues/342>`_ Tags should be of unordered / unsorted data type
* `GitLab issue #343 <https://gitlab.com/mayan-edms/mayan-edms/issues/343>`_ Bootstrap's dependency on fonts.googleapis.com causes Mayan EDMS web interface load slowly if public internet is unreachable
* `GitLab issue #355 <https://gitlab.com/mayan-edms/mayan-edms/issues/355>`_ Workflow changes only on new added documents

.. _PyPI: https://pypi.python.org/pypi/mayan-edms/
